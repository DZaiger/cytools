(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{82:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var o=n(2),a=n(6),r=(n(0),n(84));n(92),n(87),n(52);var i={id:"advanced",title:"Advanced usage"},c={unversionedId:"getting-started/advanced",id:"getting-started/advanced",isDocsHomePage:!1,title:"Advanced usage",description:"<link",source:"@site/docs/getting-started/advanced.md",slug:"/getting-started/advanced",permalink:"/docs/getting-started/advanced",version:"current",sidebar:"docs",previous:{title:"Tutorial",permalink:"/docs/getting-started/tutorial"},next:{title:"Overview",permalink:"/docs/documentation/"}},s=[{value:"What is Docker",id:"what-is-docker",children:[]},{value:"Building a Docker image",id:"building-a-docker-image",children:[]},{value:"Starting a Docker container",id:"starting-a-docker-container",children:[]},{value:"Performance tips",id:"performance-tips",children:[{value:"Caching",id:"caching",children:[]}]}],l={rightToc:s};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css",integrity:"sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG",crossOrigin:"anonymous"}),Object(r.b)("h2",{id:"what-is-docker"},"What is Docker"),Object(r.b)("p",null,"Docker is a tool for running software packages in containers, which are (roughly) very light virtual machines. The main point is that one can set up a ",Object(r.b)("strong",{parentName:"p"},"Docker image")," by using a set of instructions contained in a ",Object(r.b)("strong",{parentName:"p"},"Dockerfile"),", and then containers can be created from these images to run the desired processes isolated from each other and from the host operating system. We use a Docker image to package CYTools since it has several dependencies that are a little tricky to get working together, and so that it can be used on almost any Linux distro, macOS, and even Windows. For a more information about Docker you can visit ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://www.docker.com/"}),"their website"),"."),Object(r.b)("h2",{id:"building-a-docker-image"},"Building a Docker image"),Object(r.b)("p",null,'The "recipe" for building a Docker image are specified in a file called "Dockerfile". This file contains all of the commands that will run to install all the necessary dependencies and the software itself that we want to run. You can take a look at the Dockerfile for CYTools at ',Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/LiamMcAllisterGroup/cytools/blob/main/Dockerfile"}),"this link"),". For detailed instructions on how to write a Dockerfile you can visit ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.docker.com/engine/reference/builder/"}),"this website"),"."),Object(r.b)("p",null,"The Docker image is built with the ",Object(r.b)("inlineCode",{parentName:"p"},"docker build")," command. As a required parameter it takes the path to the Dockerfile. It is always useful to specify a name and tag with the ",Object(r.b)("inlineCode",{parentName:"p"},"-t")," option, which takes a parameter of the form ",Object(r.b)("inlineCode",{parentName:"p"},"name")," or ",Object(r.b)("inlineCode",{parentName:"p"},"name:tag"),', and if the former is used then the tag is set to "latest". Thus, the typical way to build the CYTools image is to navigate to the root of the CYTools source code and run'),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t cytools .\n")),Object(r.b)("p",null,"where the dot at the end means to use the current directory."),Object(r.b)("p",null,"You can always tweak the Dockerfile and add more packages if you need to, or modify the setup to fit your needs. All you have to do is rebuild the image again, and you will be ready to go. For more information about building Docker images you can visit ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.docker.com/engine/reference/builder/"}),"this website")," or the many other resources available online."),Object(r.b)("h2",{id:"starting-a-docker-container"},"Starting a Docker container"),Object(r.b)("p",null,"A Docker container can be started from a specified image with the ",Object(r.b)("inlineCode",{parentName:"p"},"docker run"),' command. The only required parameter is the name and tag of the image, and again "latest" is used if the tag is not specified. By default, the CYTools container is set to launch a Jupyter server running on port 2875 in the container. To access it, we must map it to a port on the computer. This can be done with the ',Object(r.b)("inlineCode",{parentName:"p"},"-p"),' option, which takes a parameter of the form "host-port:container-port". Additionally, to be able to access the files on our computer we must mount a directory as a volume on the container. This is done with the ',Object(r.b)("inlineCode",{parentName:"p"},"-v"),' option, which takes a parameter of the form "host-src:container-dest", with both paths being absolute. Other options that we use are ',Object(r.b)("inlineCode",{parentName:"p"},"--rm")," so that the container is removed once it is stopped, and ",Object(r.b)("inlineCode",{parentName:"p"},"-it")," so that it is interactive and we can use a terminal. Thus, the typical way to start a CYTools container is with the following command."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-bash"}),"docker run --rm -it -v $PWD:/home/cytools/mounted_storage -p 2875:2875 cytools\n")),Object(r.b)("p",null,"where we used ",Object(r.b)("inlineCode",{parentName:"p"},"$PWD")," to mount the current directory. Note that if you are using Windows, then in PowerShell you should use ",Object(r.b)("inlineCode",{parentName:"p"},"${PWD}")," or in the Command Prompt you should use ",Object(r.b)("inlineCode",{parentName:"p"},"%cd%"),". After running this command, you should see some output containing a URL of the form ",Object(r.b)("inlineCode",{parentName:"p"},"http://127.0.0.1:2875/?token=xxxxxxxxx")," which you have to copy and paste into your web browser of choice. If everything was set up correctly, you should find a Jupyter Lab session ready to be used."),Object(r.b)("p",null,"An extra parameter can be specified to launch a specific binary in ",Object(r.b)("inlineCode",{parentName:"p"},"$PATH"),". For example, one can launch a bash shell in a CYTools container with the following command."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-bash"}),"docker run --rm -it -v $PWD:/home/cytools/mounted_storage -p 2875:2875 cytools bash\n")),Object(r.b)("p",null,"This can be useful if one wants to use CYTools in a terminal. If you want to play around with the bash terminal in the container, you can install additional packages or modify things as you please. However, keep in mind that you have root privileges in the container, so you could accidentally delete important files."),Object(r.b)("p",null,"More information about Docker containers can be found at ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.docker.com/engine/reference/run/"}),"this link"),"."),Object(r.b)("h2",{id:"performance-tips"},"Performance tips"),Object(r.b)("h3",{id:"caching"},"Caching"),Object(r.b)("p",null,"CYTools classes cache most of the hard computations so that results don't have to be recomputed if they are needed again. While this gives a significant speedup during typical usage, one should also be aware of possible complications."),Object(r.b)("p",null,"The chached data is stored as hidden attributes of the classes, which are never exposed by any function, and they should not be directly accessed unless you know what you are doing. Accidentally modifying one of these hidden attributes may result in following computations being wrong."),Object(r.b)("p",null,"There is also the issue of memory management. If a large number of polytopes or triangulations need to be used, then it is good to make sure that not everything is kept in memory at the same time. For instance, let's look at the following example."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-python"}),"import numpy as np\nfrom cytools import Polytope\np = Polytope([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[-1,-1,-1,-1]]).dual()\ntriangs = list(p.random_triangulations_fast(N=100))\n\nfor t in triangs:\n    cy = t.get_cy()\n    intnums = cy.intersection_numbers()\n    m = cy.ambient_mori_cone()\n    # Do some other computations\n")),Object(r.b)("p",null,"In the above example we have a list of 100 triangulations that we use to construct the corresponding Calabi-Yaus and do some computations. Each Triangulation object caches its corresponding CalabiYau object, which in turn caches its intersection numbers and whatever else we compute. So if our list of triangulations is too big then we might end up running out of memory. We could solve this in two ways."),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"We could use the ",Object(r.b)("inlineCode",{parentName:"li"},"clear_cache")," function that all main classes have to clear the results of any previous computation.")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-python",metastring:"{17}","{17}":!0}),"import numpy as np\nfrom cytools import Polytope\np = Polytope([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[-1,-1,-1,-1]]).dual()\ntriangs = list(p.random_triangulations_fast(N=100))\n\nfor t in triangs:\n    cy = t.get_cy()\n    intnums = cy.intersection_numbers()\n    m = cy.ambient_mori_cone()\n    # Do some other computations\n    t.clear_cache()\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"(Preferable alternative) We could rewrite our code so that only one triangulation is kept in memory at a time. We have made this easy to do by having various functions return generator objects instead of lists.")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-python",metastring:"{4}","{4}":!0}),"import numpy as np\nfrom cytools import Polytope\np = Polytope([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],[-1,-1,-1,-1]]).dual()\ntriangs = p.random_triangulations_fast(N=100)\n\nfor t in triangs:\n    cy = t.get_cy()\n    intnums = cy.intersection_numbers()\n    m = cy.ambient_mori_cone()\n    # Do some other computations\n")))}u.isMDXComponent=!0},84:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=o,h=p["".concat(i,".").concat(m)]||p[m]||d[m]||r;return n?a.a.createElement(h,c(c({ref:t},l),{},{components:n})):a.a.createElement(h,c({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<r;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},87:function(e,t,n){"use strict";function o(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}t.a=function(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(a&&(a+=" "),a+=t);return a}},91:function(e,t,n){"use strict";var o=n(0),a=Object(o.createContext)(void 0);t.a=a},92:function(e,t,n){"use strict";var o=n(0),a=n(91);t.a=function(){var e=Object(o.useContext)(a.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}}}]);